# デフォルト設定（問題再現用）
# Apache 2.4ではダブルスラッシュ // が / に正規化される

ServerName localhost

# CGIディレクトリ
ScriptAlias /cgi-bin/ /usr/local/apache2/cgi-bin/

<Directory "/usr/local/apache2/cgi-bin">
    AllowOverride None
    Options +ExecCGI
    Require all granted
    SetHandler cgi-script
</Directory>

# Rewrite設定（コンテンツページパターン）
RewriteEngine On
LogLevel warn rewrite:trace3

# コンテンツページへのリライト
# 注意: Apache 2.4では $2 の部分で // が / に正規化されてしまう
RewriteRule ^/([a-zA-Z0-9_\-\.]+)/content/(.*)$ /cgi-bin/show.cgi?site_name=$1&content_path=$2 [PT,L,QSA]

# ログフォーマットに環境変数を追加
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
